<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat Bizzz</title>
  <!-- Include Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container" style="min-height: 100vh;">
    <h1 class="title">Chat Bizzz</h1>
    <div class="row">
      <div class="col-12">
      
        <div class="chat-messages" id="displaymessages" style="height: calc(100vh - 100px); overflow-y: auto;">
          <!-- Display chat messages here -->
         
          <!-- Add more chat messages as needed -->
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-9">
        <input type="text" id="chatmessage" class="form-control message-input" placeholder="Type your message...">
      </div>
      <div class="col-3">
        <button class="btn btn-primary send-button" id="sendbtn">Send</button>
      </div>
    </div>
  </div>
</body>
</html>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.min.js"></script>
<script>
    const ip='localhost:3000';
  const sendMessage=document.getElementById('sendbtn');
  sendMessage.onclick=async function(e){
    const message=document.getElementById('chatmessage').value;
    obj={
        message
    }
    const token=localStorage.getItem('token');
    const headers = {
        "Authorization":token
    };
   axios.post(`http://${ip}/user/sendmessage`,obj,{headers})
   .then((res)=>{
     console.log(res.data);
   })
   .catch((err)=>{
    console.log(err);
   })


  };

  window.addEventListener('DOMContentLoaded',()=>{
    const token=localStorage.getItem('token');
    const headers = {
        "Authorization":token
    };

    axios.get(`http://${ip}/user/getmessages`,{headers})
    .then((res)=>{
      console.log(res.data)
      for(var i=0;i<res.data.message.length;i++){
        showMessages(res.data.message[i]);

      }
    })
    .catch((err)=>{
      console.log(err);
    })

  })
  function showMessages(e){
    const displayChat=document.getElementById('displaymessages');
    const messageElement = document.createElement('p');
  messageElement.textContent = `${e.username}: ${e.message}`;
  
  // Append the new message to the existing content
  displayChat.appendChild(messageElement);
  
  // Optionally, you can also scroll to the bottom to always show the latest messages
  displayChat.scrollTop = displayChat.scrollHeight;
  }
 
  function fetchAndDislayMessages(){
    const token=localStorage.getItem('token');
    const headers = {
        "Authorization":token
    };

    axios.get(`http://${ip}/user/getmessages`,{headers})
    .then((res)=>{
      //console.log(res.data)
      const displayChat = document.getElementById('displaymessages');
      // Clear existing content
      displayChat.innerHTML = '';
      for(var i=0;i<res.data.message.length;i++){
        showMessages(res.data.message[i]);

      }
    })
    .catch((err)=>{
      console.log(err);
    })

  }
  //fetchAndDislayMessages();
  setInterval(fetchAndDislayMessages,1000);

</script>

